<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sports Island | é ç´„ä¸­å¿ƒ V7.3</title>
    <!-- å¼•å…¥ç³»çµ±è³‡æº -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        :root { --brand-blue: #409eff; --brand-green: #06C755; --text-black: #000000; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f2f5; color: #333; margin: 0; -webkit-font-smoothing: antialiased; }
        
        /* é é¢åˆ†æµè¦–åœ– */
        .page-view { display: none; min-height: 100vh; }
        .page-view.active { display: block; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* æ‚¨è¦æ±‚çš„å‚³çµ±å•†å‹™é¢¨æ ¼å¡ç‰‡ */
        .form-card { background: white; border: 1px solid #dcdfe6; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card-header { padding: 15px 20px; border-bottom: 1px solid #ebeef5; background: #fbfbfc; font-weight: 700; color: #1a73e8; font-size: 16px; }
        .card-body { padding: 25px 20px; }
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-size: 13px; font-weight: 700; color: #606266; margin-bottom: 6px; }
        .form-input { width: 100%; border: 1px solid #dcdfe6; border-radius: 4px; padding: 12px; font-size: 15px; outline: none; transition: 0.2s; color: #000; font-weight: 700; }
        .form-input:focus { border-color: #409eff; box-shadow: 0 0 0 2px rgba(64,158,255,0.1); }
        
        /* å°è¦½åˆ—ï¼šç´”é»‘é«˜å°æ¯” */
        .nav-active { color: var(--brand-green) !important; font-weight: 900; }
        .nav-inactive { color: #000000 !important; font-weight: 900; }

        /* æ»¿ç‰ˆèª²ç¨‹åˆ—è¡¨ */
        .list-row { display: flex; padding: 1.5rem 1rem; border-bottom: 1px solid #E5E7EB; background: white; gap: 1rem; align-items: flex-start; }
        .list-row:active { background-color: #F3F4F6; }
        
        .menu-item { display: flex; align-items: center; justify-content: space-between; padding: 1.5rem; border-bottom: 1px solid #F3F4F6; background: white; width: 100%; }

        /* å½ˆçª—æŠ½å±œ */
        .drawer-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; backdrop-filter: blur(4px); align-items: flex-end; }
        .drawer-overlay.active { display: flex; }
        .drawer-sheet { background: white; border-radius: 24px 24px 0 0; width: 100%; max-height: 92vh; overflow-y: auto; animation: sheetUp 0.3s ease-out; }
        @keyframes sheetUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        #loadOverlay { position: fixed; inset: 0; background: white; z-index: 5000; display: flex; flex-direction: column; items: center; justify-content: center; }
    </style>
</head>
<body class="pb-24">

    <!-- å•Ÿå‹•é®ç½© -->
    <div id="loadOverlay">
        <div class="animate-spin w-10 h-10 border-4 border-[#409eff] border-t-transparent rounded-full mb-4"></div>
        <p class="text-black font-black italic tracking-widest">SPORT ISLAND SYNCING</p>
    </div>

    <!-- 1. [ç¨ç«‹è¨»å†Š/ç·¨è¼¯é é¢] - ä¾ç…§æ‚¨çš„ä»£ç¢¼æ¨¡å¼ -->
    <div id="viewRegister" class="page-view py-10">
        <div class="max-w-[500px] mx-auto px-4">
            <div class="form-card">
                <div class="card-header" id="reg-page-title">æˆå“¡è³‡æ–™è¨­å®š</div>
                <div class="card-body">
                    <form id="reg-form" onsubmit="handleRegistrationSubmit(event)">
                        <!-- å®¶é•·è³‡è¨Š -->
                        <div class="form-group">
                            <label class="form-label">å®¶é•·å§“å</label>
                            <input type="text" id="parent-name" class="form-input" required placeholder="å¡«å¯«è¯ç¹«å®¶é•·å§“å">
                        </div>
                        <div class="form-group">
                            <label class="form-label">è¯ç¹«é›»è©±</label>
                            <input type="tel" id="parent-phone" class="form-input" required placeholder="09xx-xxx-xxx">
                        </div>

                        <hr class="my-6 border-gray-100">

                        <!-- å­¸å“¡è³‡è¨Š -->
                        <div class="form-group">
                            <label class="form-label">å­¸å“¡å§“å</label>
                            <input type="text" id="student-name" class="form-input" required placeholder="å¡«å¯«åƒåŠ å­¸å“¡å§“å">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å­¸å“¡æ€§åˆ¥</label>
                            <div class="flex gap-8 pt-2">
                                <label class="flex items-center gap-2 font-bold"><input type="radio" name="gender" value="ç”·" checked class="w-5 h-5 accent-[#409eff]"> ç”·ç”Ÿ</label>
                                <label class="flex items-center gap-2 font-bold"><input type="radio" name="gender" value="å¥³" class="w-5 h-5 accent-[#409eff]"> å¥³ç”Ÿ</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å‡ºç”Ÿæ—¥æœŸ</label>
                            <input type="date" id="student-birthday" class="form-input" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">å°±è®€å­¸æ ¡</label>
                                <input type="text" id="student-school" class="form-input" placeholder="ä¾‹å¦‚ï¼šæ–°ç«¹åœ‹å°">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ç›®å‰å¹´ç´š</label>
                                <select id="student-grade" class="form-input" required>
                                    <option value="">è«‹é¸æ“‡</option>
                                    <option value="å¹¼å…’çµ„">å¹¼å…’çµ„</option>
                                    <option value="ä½å¹´ç´š">åœ‹å°ä½å¹´ç´š</option>
                                    <option value="ä¸­å¹´ç´š">åœ‹å°ä¸­å¹´ç´š</option>
                                    <option value="é«˜å¹´ç´š">åœ‹å°é«˜å¹´ç´š</option>
                                    <option value="åœ‹é«˜ä¸­">åœ‹é«˜ä¸­</option>
                                    <option value="æˆäºº">æˆäºº</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-10">
                            <button type="submit" id="btn-reg-submit" class="w-full py-4 bg-[#409eff] text-white rounded font-black text-lg shadow-lg active:scale-95 transition-all">å„²å­˜ä¸¦ç¢ºèªè³‡æ–™ ğŸ’¾</button>
                            <button type="button" onclick="backToApp()" class="w-full mt-3 py-4 border border-gray-200 text-gray-500 bg-white rounded font-bold">å–æ¶ˆè¿”å›</button>
                        </div>
                    </form>
                </div>
            </div>
            <p class="text-center text-[10px] text-gray-400 mt-6 px-4 italic uppercase tracking-widest">Official Registration Portal</p>
        </div>
    </div>

    <!-- 2. [ä¸»ç³»çµ±è¦–åœ–] -->
    <div id="viewApp" class="page-view">
        <header class="sticky top-0 z-50 bg-white border-b-2 border-gray-100 px-6 py-5 flex items-center justify-between">
            <div class="flex items-center gap-3"><div class="w-9 h-9 bg-[#06C755] rounded-xl flex items-center justify-center font-bold text-white text-xl italic">S</div><h1 class="text-2xl font-black italic tracking-tighter uppercase font-sans">Sports Island</h1></div>
            <div class="w-10 h-10 rounded-full border-2 border-white shadow overflow-hidden bg-gray-100"><img id="userImg" src="" class="w-full h-full object-cover"></div>
        </header>

        <!-- Tab: é¦–é  -->
        <div id="tabHome" class="tab-content active">
            <div class="relative w-full h-52 overflow-hidden shadow-sm"><img src="https://aiwe.cc/wp-content/uploads/2025/12/3486bc19dc6317e16bf4f1449ec52ae4.jpg" class="w-full h-full object-cover"></div>
            <div class="grid grid-cols-2 gap-0 border-b-2 border-gray-200">
                <button onclick="changeTab('courses')" class="bg-white py-7 flex items-center justify-center gap-4 active:bg-gray-50 border-r border-gray-100 font-black text-black"><i data-lucide="calendar-plus" class="w-6 h-6 text-green-500"></i>èª²ç¨‹é ç´„</button>
                <button onclick="changeTab('member')" class="bg-white py-7 flex items-center justify-center gap-4 active:bg-gray-50 font-black text-black"><i data-lucide="user-check" class="w-6 h-6 text-blue-500"></i>æœƒå“¡ä¸­å¿ƒ</button>
            </div>
            <div class="mt-8 px-6 text-black"><h3 class="text-xs font-black uppercase tracking-[0.2em] mb-6 flex items-center gap-2 italic"><i data-lucide="megaphone" class="w-5 h-5 text-amber-500"></i> æœ€æ–°å…¬å‘Šè¨Šæ¯</h3><div id="annList" class="divide-y divide-gray-100 border-t border-gray-100 font-bold"></div></div>
            <div id="homeList" class="border-t border-gray-100 pb-12"></div>
        </div>

        <!-- Tab: é ç´„æ¸…å–® -->
        <div id="tabCourses" class="tab-content">
            <div class="p-5 bg-gray-50 border-b border-gray-100 flex items-center gap-4"><i data-lucide="search" class="w-6 h-6 text-black font-black"></i><input type="text" placeholder="æœå°‹èª²ç¨‹ã€åœ°é»ã€æ•™ç·´..." class="flex-1 outline-none text-lg bg-transparent font-black text-black"></div>
            <div id="fullList" class="divide-y divide-gray-100"></div>
        </div>

        <!-- Tab: æœƒå“¡å°ˆå€ (ç¨ç«‹å…©å¤§å…¥å£) -->
        <div id="tabMember" class="tab-content animate-in slide-in-from-bottom px-6 pt-10">
            <div class="bg-black p-10 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden mb-12 border-4 border-gray-950">
                <div class="absolute -right-12 -top-12 w-64 h-64 bg-green-500/10 rounded-full blur-[80px]"></div>
                <h2 id="userName" class="text-5xl font-black italic uppercase font-sans mb-14 tracking-tighter">--</h2>
                <div class="grid grid-cols-2 border-t border-white/10 pt-10 gap-8">
                    <div><p class="text-xs font-black text-gray-500 uppercase mb-2 tracking-widest italic">é»æ•¸é¤˜é¡</p><p id="userPoints" class="text-5xl font-black text-[#06C755] font-sans tracking-tighter">--</p></div>
                    <div><p class="text-xs font-black text-gray-500 uppercase mb-2 tracking-widest italic">ç­‰ç´šæ¬Šé™</p><p id="userLevel" class="text-5xl font-black text-blue-400 font-sans tracking-tighter">--</p></div>
                </div>
            </div>
            
            <!-- ç¨ç«‹çš„å…©å¤§ ITEM -->
            <div class="flex flex-col w-full border-t-2 border-gray-100 bg-white">
                <button onclick="handleMemberReg()" class="menu-item">
                    <div class="flex items-center gap-6">
                        <div class="w-16 h-16 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center shadow-inner"><i data-lucide="user-cog" class="w-9 h-9"></i></div>
                        <div class="text-left"><p class="text-2xl font-black text-black">1. æœƒå“¡è¨»å†Š</p><p class="text-xs font-black text-black opacity-30 italic">Profile Information</p></div>
                    </div>
                    <i data-lucide="chevron-right" class="w-8 h-8 text-black opacity-30"></i>
                </button>
                <button onclick="handleHistoryView()" class="menu-item">
                    <div class="flex items-center gap-6">
                        <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center shadow-inner"><i data-lucide="history" class="w-9 h-9"></i></div>
                        <div class="text-left"><p class="text-2xl font-black text-black">2. ä¸Šèª²ç´€éŒ„</p><p class="text-xs font-black text-black opacity-40 italic">Activity History</p></div>
                    </div>
                    <i data-lucide="chevron-right" class="w-8 h-8 text-black opacity-30"></i>
                </button>
            </div>
        </div>

        <nav id="mainNav" class="fixed bottom-0 inset-x-0 bg-white border-t-4 border-gray-100 h-28 flex items-center justify-around z-50 px-8 shadow-2xl">
            <button onclick="changeTab('home')" id="navHome" class="flex flex-col items-center gap-2 nav-active transition-all"><i data-lucide="home" class="w-9 h-9"></i><span class="text-[11px] font-black uppercase tracking-widest">é¦–é </span></button>
            <button onclick="changeTab('courses')" id="navCourses" class="flex flex-col items-center gap-2 nav-inactive transition-all"><i data-lucide="calendar" class="w-9 h-9"></i><span class="text-[11px] font-black uppercase tracking-widest">é ç´„</span></button>
            <button onclick="changeTab('member')" id="navMember" class="flex flex-col items-center gap-2 nav-inactive transition-all"><i data-lucide="user" class="w-9 h-9"></i><span class="text-[11px] font-black uppercase tracking-widest">æˆ‘çš„</span></button>
        </nav>
    </div>

    <!-- 3. [ç¨ç«‹ç´€éŒ„è¦–åœ–] -->
    <div id="viewHistory" class="page-view p-8 bg-white overflow-y-auto">
        <button onclick="backToApp()" class="flex items-center gap-4 font-black text-2xl mb-12 text-black"><i data-lucide="chevron-left" class="w-8 h-8 text-black"></i> è¿”å›ä¸»é </button>
        <h3 class="text-5xl font-black italic uppercase tracking-tighter mb-10 border-b-8 border-[#06C755] w-fit">HISTORY</h3>
        <div id="historyList" class="flex flex-col items-center py-32 opacity-40 italic font-black text-black uppercase tracking-widest"><i data-lucide="scroll-text" class="w-16 h-16 mb-4"></i>ç›®å‰å°šæœªæœ‰ç´€éŒ„</div>
    </div>

    <!-- è©³ç´°æŠ½å±œ (Detail Drawer) -->
    <div id="detailPopup" class="drawer-overlay" onclick="closePopup()">
        <div class="drawer-sheet" onclick="event.stopPropagation()">
            <div class="w-16 h-1.5 bg-gray-200 rounded-full mx-auto my-5"></div>
            <div class="relative w-full h-80 bg-gray-50"><img id="popImg" src="" class="w-full h-full object-cover"></div>
            <div class="p-8 pb-14">
                <div class="flex gap-3 mb-6">
                    <span id="popLevel" class="bg-black text-white text-xs font-black px-3 py-1.5 rounded uppercase tracking-widest">LEVEL</span>
                    <span id="popStatus" class="bg-[#06C755] text-white text-xs font-black px-3 py-1.5 rounded uppercase font-sans">OPEN</span>
                </div>
                <h3 id="popTitle" class="text-4xl font-black mb-10 text-black leading-tight tracking-tighter">-- --</h3>
                <div class="space-y-6 mb-12 border-b-2 border-gray-50 pb-10">
                    <div class="flex items-center gap-6"><i data-lucide="map-pin" class="w-8 h-8 text-red-600"></i><div><p class="text-xs font-black text-black mb-1 tracking-widest italic uppercase">Location</p><p id="popVenue" class="font-black text-2xl text-black">--</p></div></div>
                    <div class="flex items-center gap-6"><i data-lucide="user" class="w-8 h-8 text-blue-600"></i><div><p class="text-xs font-black text-black mb-1 tracking-widest italic uppercase">Coach</p><p id="popCoach" class="font-black text-2xl text-black">--</p></div></div>
                    <div class="flex items-center gap-6"><i data-lucide="calendar-clock" class="w-8 h-8 text-orange-600"></i><div><p class="text-xs font-black text-black mb-1 tracking-widest italic font-sans uppercase">Schedule</p><p id="popTime" class="font-black text-2xl text-black font-sans">--</p></div></div>
                </div>
                <div class="mb-12 p-10 bg-gray-50 rounded-[3rem] text-black">
                    <p id="popDesc" class="leading-relaxed text-2xl font-black whitespace-pre-wrap tracking-tighter">è¼‰å…¥ä¸­...</p>
                </div>
                <div class="flex items-center justify-between">
                    <div><p class="text-xs font-black text-black mb-1 italic uppercase tracking-widest">Booking Price</p><p id="popPrice" class="text-5xl font-black text-red-600 font-sans tracking-tighter">$ --</p></div>
                    <button class="bg-[#06C755] text-white px-16 py-6 rounded-[2rem] font-black shadow-2xl uppercase text-2xl active:scale-95 transition-all">é ç´„</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const PROXY_URL = 'https://curly-feather-9ac5.wetw-net3.workers.dev/';
        const LIFF_ID = '2008786875-7COWtgtL';
        let currentUser = null; let activeCourses = [];

        window.onload = async () => {
            lucide.createIcons();
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) liff.login();
                else {
                    const profile = await liff.getProfile();
                    await syncUser(profile);
                    await syncCourses();
                }
            } catch (err) { console.error("LIFF Failed", err); }
        };

        async function syncUser(profile) {
            const res = await fetch(`${PROXY_URL}?action=userLogin&userId=${profile.userId}&displayName=${profile.displayName}`);
            const data = await res.json();
            document.getElementById('loadOverlay').style.display = 'none';
            if (data.success) {
                currentUser = data.user;
                // åˆ†æµåˆ¤æ–·ï¼šå®¶é•·æ‰‹æ©Ÿæˆ–å­¸å“¡å§“åç¼ºå¤±ï¼Œé€²å…¥è¨»å†Šé 
                if (!currentUser.parentPhone || !currentUser.birthday) {
                    switchView('viewRegister');
                    document.getElementById('student-name').value = currentUser.studentName || '';
                } else {
                    switchView('viewApp');
                    updateUI(profile);
                }
            }
        }

        async function handleRegistrationSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-reg-submit');
            btn.disabled = true; btn.innerText = "è³‡æ–™å‚³è¼¸ä¸­...";

            const payload = {
                action: 'updateRegistration',
                payload: {
                    uid: currentUser.userId,
                    parentName: document.getElementById('parent-name').value.trim(),
                    parentPhone: document.getElementById('parent-phone').value.trim(),
                    studentName: document.getElementById('student-name').value.trim(),
                    gender: document.querySelector('input[name="gender"]:checked').value,
                    birthday: document.getElementById('student-birthday').value,
                    school: document.getElementById('student-school').value.trim(),
                    grade: document.getElementById('student-grade').value
                }
            };

            try {
                const res = await fetch(PROXY_URL, { method: 'POST', body: JSON.stringify(payload) });
                const r = await res.json();
                if (r.status === 'success') {
                    showMsg('check-circle', 'âœ… è³‡æ–™å·²æˆåŠŸå„²å­˜ï¼');
                    setTimeout(() => location.reload(), 1500);
                }
            } catch (err) {
                btn.disabled = false; btn.innerText = "å„²å­˜ä¸¦ç¢ºèªè³‡æ–™ ğŸ’¾";
            }
        }

        function updateUI(profile) {
            document.getElementById('userName').innerText = currentUser.studentName;
            document.getElementById('userPoints').innerText = currentUser.points;
            document.getElementById('userLevel').innerText = currentUser.level;
            document.getElementById('userImg').src = profile.pictureUrl || '';
            // é å¡«è¨»å†Šè¡¨å–®ä»¥ä¾¿ä¿®æ”¹
            document.getElementById('parent-name').value = currentUser.parentName || '';
            document.getElementById('parent-phone').value = currentUser.parentPhone || '';
            document.getElementById('student-name').value = currentUser.studentName || '';
            document.getElementById('student-birthday').value = currentUser.birthday ? currentUser.birthday.split('T')[0] : '';
            document.getElementById('student-school').value = currentUser.school || '';
            document.getElementById('student-grade').value = currentUser.grade || '';
            const gds = document.getElementsByName('gender');
            for (let g of gds) if (g.value === currentUser.gender) g.checked = true;
        }

        function switchView(id) { document.querySelectorAll('.page-view').forEach(v => v.classList.remove('active')); document.getElementById(id).classList.add('active'); lucide.createIcons(); }
        function handleMemberReg() { switchView('viewRegister'); }
        function handleHistoryView() { switchView('viewHistory'); }
        function backToApp() { switchView('viewApp'); }
        function cleanTime(t) { return t ? t.toString().replace(/:00/g, '').replace(/T.*Z/, '') : '--:--'; }

        function changeTab(tabId) { 
            document.querySelectorAll('.tab-content').forEach(p => p.classList.remove('active')); 
            document.getElementById('tab' + tabId.charAt(0).toUpperCase() + tabId.slice(1)).classList.add('active'); 
            document.querySelectorAll('nav button').forEach(b => { b.classList.remove('nav-active'); b.classList.add('nav-inactive'); }); 
            document.getElementById('nav' + tabId.charAt(0).toUpperCase() + tabId.slice(1)).classList.replace('nav-inactive', 'nav-active'); 
            lucide.createIcons(); window.scrollTo({ top: 0, behavior: 'smooth' }); 
        }

        async function syncCourses() {
            try {
                const [annR, crsR] = await Promise.all([ fetch(`${PROXY_URL}?action=getAnnouncements`), fetch(`${PROXY_URL}?action=getCourses`) ]);
                const anns = await annR.json(); const crs = await crsR.json();
                activeCourses = crs;
                document.getElementById('annList').innerHTML = anns.slice(0,3).reverse().map(a => `<div class="py-6 flex items-start gap-4 active:bg-gray-50 transition-colors"><div class="w-2.5 h-2.5 rounded-full bg-[#06C755] mt-2 shrink-0"></div><p class="text-xl font-black text-black leading-tight tracking-tight">${a.title}</p></div>`).join('');
                const buildRow = (c) => `
                    <div class="list-row" onclick="openDetail('${c.id}')">
                        <div class="w-32 h-32 shrink-0 rounded-2xl overflow-hidden bg-gray-100 border-2 border-gray-100 shadow-sm relative"><img src="${c.coverUrl || 'https://via.placeholder.com/400'}" class="w-full h-full object-cover"><div class="absolute top-0 left-0"><span class="bg-black text-white text-[9px] font-black px-2.5 py-1 rounded-br-lg uppercase tracking-widest">${c.levelReq}</span></div></div>
                        <div class="flex-1 min-w-0 flex flex-col justify-between self-stretch">
                            <div>
                                <h4 class="font-black text-black text-2xl truncate uppercase mb-1 tracking-tighter">${c.name}</h4>
                                <div class="flex items-center gap-1.5 text-base font-black text-red-600 mb-1.5 italic font-sans"><i data-lucide="map-pin" class="w-4 h-4 text-red-600"></i> ${c.venue || 'å ´é¤¨åœ°é»æœªå®š'}</div>
                                <div class="text-sm font-black text-black flex items-center gap-4 italic"><span class="flex items-center gap-1.5"><i data-lucide="user" class="w-4 h-4 text-blue-600"></i> ${c.coach}</span><span>${c.date.split('T')[0]} ${cleanTime(c.time)}</span></div>
                            </div>
                            <div class="flex items-end justify-between mt-4">
                                <div class="flex items-baseline gap-2 font-sans text-black"><span class="text-[10px] font-black line-through opacity-30">$${c.price}</span><span class="text-3xl font-black text-red-600 tracking-tighter">$${c.earlyPrice || c.price}</span></div>
                                <button class="bg-[#06C755] text-white px-8 py-3.5 rounded-2xl text-sm font-black shadow-xl uppercase active:scale-90 transition-all">é ç´„</button>
                            </div>
                        </div>
                    </div>`;
                document.getElementById('homeList').innerHTML = crs.slice(0,5).map(c => renderRow(c)).join('');
                document.getElementById('fullList').innerHTML = crs.map(c => renderRow(c)).join(''); lucide.createIcons();
            } catch(e) { console.error("Sync Error", e); }
        }

        function openDetail(id) {
            const c = activeCourses.find(x => x.id === id); if(!c) return;
            document.getElementById('popImg').src = c.descImgUrl || c.coverUrl || 'https://via.placeholder.com/600';
            document.getElementById('popTitle').innerText = c.name;
            document.getElementById('popLevel').innerText = c.levelReq;
            document.getElementById('popStatus').innerText = c.status || 'OPEN';
            document.getElementById('popVenue').innerText = c.venue || 'çƒå ´åœ°é»';
            document.getElementById('popCoach').innerText = c.coach || 'å°ˆæ¥­æ•™ç·´';
            document.getElementById('popTime').innerText = `${c.date.split('T')[0]} ${cleanTime(c.time)}`;
            document.getElementById('popDesc').innerText = c.courseDesc || 'å°šç„¡å…§å®¹ã€‚';
            document.getElementById('popPrice').innerText = `$${c.earlyPrice || c.price}`;
            document.getElementById('detailPopup').classList.add('active'); lucide.createIcons();
        }

        function showMsg(icon, text) { const box = document.getElementById('msgBox'); document.getElementById('msgIcon').innerHTML = `<i data-lucide="${icon}" class="w-20 h-20 text-[#06C755]"></i>`; document.getElementById('msgText').innerText = text; box.style.display = 'block'; lucide.createIcons(); }
        function closeMsg() { document.getElementById('msgBox').style.display = 'none'; }
        function closePopup() { document.getElementById('detailPopup').classList.remove('active'); }
    </script>
</body>
</html>
